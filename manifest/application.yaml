apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: portfolio
  namespace: argocd
spec:
  project: default
  source:
    repoURL: 'https://github.com/blancnoir256/Portfolio-V2-infra'
    targetRevision: HEAD # mainブランチを監視
    path: . # リポジトリのルートディレクトリを参照
  destination:
    server: 'https://kubernetes.default.svc' # microk8sクラスタ自身を指す
    namespace: default # デプロイ先のnamespace
  syncPolicy:
    automated:
      prune: true # repoから消されたらクラスタからも消す
      selfHeal: true # クラスタの状態がrepoとずれたら自動修正
